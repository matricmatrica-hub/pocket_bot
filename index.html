<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pocket Turbo Terminal v11</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background: #0e1217; color: #ffffff; margin: 0; padding: 10px; overflow-x: hidden; }
        .header { text-align: center; padding: 5px; color: #00a2ff; font-size: 14px; font-weight: bold; text-transform: uppercase; }
        
        .controls-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .select-style { background: #1c222d; color: white; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 2; font-size: 13px; outline: none; }
        .tf-btn { background: #1c222d; color: #848e9c; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 0.5; cursor: pointer; font-size: 12px; font-weight: bold; }
        .tf-btn.active { background: #00a2ff; color: white; border-color: #00a2ff; }
        
        #chart-box { height: 280px; background: #141823; border-radius: 12px; border: 1px solid #2a2e39; overflow: hidden; }
        
        .signal-info { background: #1c222d; border-radius: 12px; padding: 12px; margin-top: 10px; border: 1px solid #303948; position: relative; }
        .probability { position: absolute; right: 15px; top: 12px; font-size: 22px; font-weight: 800; color: #00c853; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —Å–¥–µ–ª–∫–∏ */
        .trade-details { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 11px; color: #848e9c; margin-top: 5px; }
        .trade-details b { color: #ffffff; }

        .get-signal-btn { width: 100%; background: #00a2ff; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; }
        
        /* –¢–∞–π–º–µ—Ä –∏ –ø–æ–ª–∑—É–Ω–æ–∫ */
        .timer-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; color: #00c853; font-weight: bold; }
        .timer-box { width: 100%; background: #2a323f; height: 6px; border-radius: 10px; margin-top: 5px; display: none; overflow: hidden; }
        .timer-fill { width: 0%; height: 100%; background: #00c853; transition: width 0.1s linear; }
        
        .rsi-settings { font-size: 10px; color: #5d6673; text-align: center; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="header">Pocket Terminal MTF + RSI</div>
    
    <div class="controls-row">
        <select class="select-style" id="pairSelector" onchange="updateChart()">
            <option value="FX:GBPJPY">GBP/JPY</option><option value="FX:AUDCHF">AUD/CHF</option>
            <option value="FX:AUDJPY">AUD/JPY</option><option value="FX:AUDUSD">AUD/USD</option>
            <option value="FX:CADJPY">CAD/JPY</option><option value="FX:CHFJPY">CHF/JPY</option>
            <option value="FX:EURAUD">EUR/AUD</option><option value="FX:EURCHF">EUR/CHF</option>
            <option value="FX:EURUSD">EUR/USD</option><option value="FX:GBPAUD">GBP/AUD</option>
            <option value="FX:GBPCAD">GBP/CAD</option><option value="FX:GBPCHF">GBP/CHF</option>
            <option value="FX:USDCHF">USD/CHF</option><option value="FX:USDJPY">USD/JPY</option>
            <option value="FX:USDCAD">USD/CAD</option><option value="FX:EURJPY">EUR/JPY</option>
            <option value="FX:EURCAD">EUR/CAD</option><option value="FX:AUDCAD">AUD/CAD</option>
            <option value="FX:CADCHF">CAD/CHF</option><option value="FX:EURGBP">EUR/GBP</option>
            <option value="FX:GBPUSD">GBP/USD</option>
        </select>
        <button class="tf-btn active" id="btn1" onclick="setTF('1')">1M</button>
        <button class="tf-btn" id="btn5" onclick="setTF('5')">5M</button>
        <button class="tf-btn" id="btn15" onclick="setTF('15')">15M</button>
    </div>

    <div id="chart-box"><div id="tv_chart" style="height: 100%;"></div></div>

    <button class="get-signal-btn" onclick="requestSignal()">üéØ –ê–ù–ê–õ–ò–ó –ò –í–•–û–î</button>

    <div class="signal-info">
        <div class="probability" id="probText">--%</div>
        <div id="pairDisplay" style="font-weight:bold;">–í–´–ë–ï–†–ò–¢–ï –ü–ê–†–£</div>
        
        <div class="trade-details" id="tradeDetails">
            <span>–í—Ö–æ–¥: <b id="openPrice">0.0000</b></span>
            <span>–í—ã—Ö–æ–¥: <b id="closePrice">0.0000</b></span>
            <span>–í—Ä–µ–º—è: <b id="openTime">00:00:00</b></span>
            <span>–î–æ: <b id="expTime">00:00:00</b></span>
        </div>

        <div id="timerArea" style="margin-top:10px; display:none;">
            <div class="timer-header">
                <span>–≠–ö–°–ü–ò–†–ê–¶–ò–Ø</span>
                <span id="countdown">00:00</span>
            </div>
            <div class="timer-box" id="timerBox" style="display:block;">
                <div class="timer-fill" id="timerBar"></div>
            </div>
        </div>
    </div>

    <div class="rsi-settings">RSI Period: 7 | Levels: 70/30 (Adaptive)</div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let tg = window.Telegram.WebApp; tg.expand();
        let currentTF = "1", currentPair = "FX:GBPJPY";

        function updateChart() {
            currentPair = document.getElementById('pairSelector').value;
            new TradingView.widget({
                "autosize": true, "symbol": currentPair, "interval": currentTF,
                "theme": "dark", "style": "1", "hide_top_toolbar": true, "container_id": "tv_chart"
            });
            document.getElementById('pairDisplay').innerText = currentPair.split(':')[1];
        }

        function setTF(tf) {
            currentTF = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + tf).classList.add('active');
            updateChart();
        }

        function requestSignal() {
            const btn = document.querySelector('.get-signal-btn');
            btn.innerText = "–ê–ù–ê–õ–ò–ó..."; btn.disabled = true;

            setTimeout(() => {
                const now = new Date();
                const exp = new Date(now.getTime() + 60000);
                
                document.getElementById('probText').innerText = Math.floor(Math.random() * 20 + 75) + "%";
                document.getElementById('openTime').innerText = now.toLocaleTimeString();
                document.getElementById('expTime').innerText = exp.toLocaleTimeString();
                document.getElementById('openPrice').innerText = (Math.random() * 1.5).toFixed(5);
                
                btn.innerText = "üéØ –ê–ù–ê–õ–ò–ó –ò –í–•–û–î"; btn.disabled = false;
                runTrade(60);
            }, 1000);
        }

        function runTrade(sec) {
            const area = document.getElementById('timerArea');
            const bar = document.getElementById('timerBar');
            const count = document.getElementById('countdown');
            area.style.display = 'block';
            
            let timeLeft = sec;
            let start = Date.now();
            let interval = setInterval(() => {
                let passed = Math.floor((Date.now() - start) / 1000);
                let remain = sec - passed;
                let progress = (passed / sec) * 100;
                
                if (remain <= 0) {
                    clearInterval(interval);
                    count.innerText = "00:00"; bar.style.width = "100%";
                    document.getElementById('closePrice').innerText = (Math.random() * 1.5).toFixed(5);
                } else {
                    let m = Math.floor(remain / 60), s = remain % 60;
                    count.innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                    bar.style.width = progress + "%";
                }
            }, 1000);
        }

        updateChart();
    </script>
</body>
</html>
