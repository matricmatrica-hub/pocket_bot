<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pocket Smart Bot v22 - TradingView Sync</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background: #0e1217; color: #ffffff; margin: 0; padding: 10px; overflow: hidden; }
        .header { text-align: center; padding: 5px; color: #00a2ff; font-size: 14px; font-weight: bold; text-transform: uppercase; }
        .controls-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .select-style { background: #1c222d; color: white; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 2; font-size: 13px; outline: none; }
        .tf-btn { background: #1c222d; color: #848e9c; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 0.5; cursor: pointer; font-size: 12px; font-weight: bold; }
        .tf-btn.active { background: #00a2ff; color: white; border-color: #00a2ff; }
        #chart-box { height: 260px; background: #141823; border-radius: 12px; border: 1px solid #2a2e39; overflow: hidden; }
        .signal-card { background: #1c222d; border-radius: 12px; padding: 15px; margin-top: 10px; border: 1px solid #303948; position: relative; }
        .probability { position: absolute; right: 15px; top: 12px; font-size: 28px; font-weight: 900; color: #00c853; }
        .direction-text { font-size: 20px; font-weight: bold; margin: 5px 0; }
        .up-color { color: #00c853; }
        .down-color { color: #ff3d00; }
        .trade-details { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; color: #848e9c; margin-top: 10px; border-top: 1px solid #2a323f; padding-top: 10px; }
        .trade-details b { color: #ffffff; font-family: monospace; }
        .get-signal-btn { width: 100%; background: #00a2ff; color: white; border: none; padding: 16px; border-radius: 8px; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; }
        .timer-area { margin-top: 12px; display: none; }
        .timer-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; color: #848e9c; }
        .timer-box { width: 100%; background: #2a323f; height: 6px; border-radius: 10px; overflow: hidden; }
        .timer-fill { width: 0%; height: 100%; background: #00c853; transition: width 1s linear; }
        #local-clock { color: #00a2ff; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">TV-SYNC TERMINAL v22</div>
    <div class="controls-row">
        <select class="select-style" id="pairSelector" onchange="updateChart()">
            <option value="FX:EURUSD">EUR/USD</option>
            <option value="FX:GBPJPY">GBP/JPY</option>
            <option value="FX:GBPUSD">GBP/USD</option>
            <option value="FX:USDJPY">USD/JPY</option>
            <option value="FX:AUDUSD">AUD/USD</option>
            <option value="FX:USDCHF">USD/CHF</option>
        </select>
        <button class="tf-btn active" id="btn1" onclick="setTF('1')">1M</button>
        <button class="tf-btn" id="btn5" onclick="setTF('5')">5M</button>
    </div>
    <div id="chart-box"><div id="tv_chart" style="height: 100%;"></div></div>
    <button class="get-signal-btn" onclick="requestSignal()">üéØ –ê–ù–ê–õ–ò–ó TRADINGVIEW</button>
    
    <div class="signal-card">
        <div class="probability" id="probText">--%</div>
        <div id="pairDisplay" style="font-weight:bold; color: #00a2ff;">EURUSD</div>
        <div id="directionText" class="direction-text">–û–ñ–ò–î–ê–ù–ò–ï...</div>
        <div class="trade-details">
            <span>–í–•–û–î: <b id="openPrice">0.00000</b></span>
            <span>–í–´–•–û–î: <b id="closePrice">0.00000</b></span>
            <span>–ò–¢–û–ì: <b id="finalResult">---</b></span>
            <span>–°–†–û–ö: <b id="tradeDur">-- –ú–ò–ù</b></span>
        </div>
        <div class="timer-area" id="timerArea">
            <div class="timer-header"><span>–≠–ö–°–ü–ò–†–ê–¶–ò–Ø</span><span id="countdown">00:00</span></div>
            <div class="timer-box"><div class="timer-fill" id="timerBar"></div></div>
        </div>
    </div>

    <div style="font-size: 10px; color: #5d6673; text-align: center; margin-top: 10px;">
        –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –° RU.TRADINGVIEW.COM<br>
        –í—Ä–µ–º—è (–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω): <span id="local-clock">00:00:00</span>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let currentTF = "1", currentPair = "FX:EURUSD";
        
        // –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Ä—ã–Ω–∫–æ–º
        const realMarketPrices = {
            "FX:EURUSD": 1.10420, "FX:GBPJPY": 210.650, "FX:GBPUSD": 1.29450,
            "FX:USDJPY": 154.220, "FX:AUDUSD": 0.66480, "FX:USDCHF": 0.88450
        };

        setInterval(() => {
            const now = new Date();
            const tjTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (3600000 * 5));
            document.getElementById('local-clock').innerText = tjTime.toLocaleTimeString('ru-RU');
        }, 1000);

        function updateChart() {
            currentPair = document.getElementById('pairSelector').value;
            new TradingView.widget({
                "autosize": true, "symbol": currentPair, "interval": currentTF,
                "theme": "dark", "style": "1", "container_id": "tv_chart",
                "studies": ["RSI@tv-basicstudies"]
            });
            document.getElementById('pairDisplay').innerText = currentPair.split(':')[1];
        }

        function requestSignal() {
            const btn = document.querySelector('.get-signal-btn');
            btn.innerText = "–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö TV..."; btn.disabled = true;

            setTimeout(() => {
                let base = realMarketPrices[currentPair] || 1.00000;
                let volatility = (Math.random() * 0.00040) - 0.00020;
                let entryPrice = (base + volatility).toFixed(currentPair.includes("JPY") ? 3 : 5);
                
                let isUp = Math.random() > 0.5;
                let prob = Math.floor(Math.random() * 10 + 86);
                let dur = prob > 91 ? 2 : 1;

                document.getElementById('probText').innerText = prob + "%";
                document.getElementById('openPrice').innerText = entryPrice;
                document.getElementById('tradeDur').innerText = dur + " –ú–ò–ù";
                document.getElementById('finalResult').innerText = "–ê–ù–ê–õ–ò–ó...";
                
                const dirEl = document.getElementById('directionText');
                dirEl.innerText = isUp ? "–í–í–ï–†–• üü¢ (CALL)" : "–í–ù–ò–ó üî¥ (PUT)";
                dirEl.className = "direction-text " + (isUp ? "up-color" : "down-color");

                btn.innerText = "üéØ –ê–ù–ê–õ–ò–ó TRADINGVIEW"; btn.disabled = false;
                startTimer(dur * 60, isUp, parseFloat(entryPrice), prob);
            }, 1200);
        }

        function startTimer(sec, isUp, openP, prob) {
            const area = document.getElementById('timerArea');
            const bar = document.getElementById('timerBar');
            const count = document.getElementById('countdown');
            area.style.display = 'block';
            let start = Date.now();
            let interval = setInterval(() => {
                let passed = Math.floor((Date.now() - start) / 1000);
                let remain = sec - passed;
                if (remain <= 0) {
                    clearInterval(interval);
                    count.innerText = "00:00"; bar.style.width = "100%";
                    
                    const win = (Math.random() * 100) < prob;
                    const diff = currentPair.includes("JPY") ? 0.030 : 0.00030;
                    let closeP = win ? (isUp ? openP + diff : openP - diff) : (isUp ? openP - diff : openP + diff);
                    
                    document.getElementById('closePrice').innerText = closeP.toFixed(currentPair.includes("JPY") ? 3 : 5);
                    document.getElementById('finalResult').innerText = win ? "‚úÖ –ü–õ–Æ–°" : "‚ùå –ú–ò–ù–£–°";
                    document.getElementById('finalResult').style.color = win ? "#00c853" : "#ff3d00";
                } else {
                    let m = Math.floor(remain / 60), s = remain % 60;
                    count.innerText = `${m}:${s.toString().padStart(2,'0')}`;
                    bar.style.width = (passed / sec * 100) + "%";
                }
            }, 1000);
        }
        function setTF(tf) {
            currentTF = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + tf).classList.add('active');
            updateChart();
        }
        updateChart();
    </script>
</body>
</html>
