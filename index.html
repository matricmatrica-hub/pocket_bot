<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini Pro Terminal v23</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* PRO DESIGN SYSTEM */
        body { font-family: 'Roboto', sans-serif; background: #0b0e11; color: #e1e1e1; margin: 0; padding: 12px; overflow: hidden; }
        .header { text-align: center; padding: 8px; color: #00a2ff; font-size: 13px; font-weight: 900; letter-spacing: 1.5px; text-transform: uppercase; border-bottom: 1px solid #1c222d; margin-bottom: 15px; }
        
        .controls-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 6px; margin-bottom: 12px; }
        .select-style { background: #1c222d; color: #fff; border: 1px solid #2a323f; padding: 0 10px; border-radius: 6px; font-size: 13px; outline: none; height: 40px; }
        .tf-btn { background: #1c222d; color: #777; border: 1px solid #2a323f; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: bold; transition: 0.2s; height: 40px; }
        .tf-btn.active { background: #00a2ff; color: #fff; border-color: #00a2ff; box-shadow: 0 2px 8px rgba(0, 162, 255, 0.2); }
        
        #chart-container { height: 280px; background: #141823; border-radius: 8px; border: 1px solid #2a2e39; overflow: hidden; position: relative; margin-bottom: 12px; }
        
        /* SIGNAL PANEL */
        .signal-panel { background: #151a21; border-radius: 8px; padding: 15px; border: 1px solid #2a323f; position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #2a323f; padding-bottom: 8px; }
        .pair-title { font-size: 16px; font-weight: bold; color: #fff; }
        .prob-badge { background: rgba(0, 200, 83, 0.15); color: #00c853; padding: 4px 8px; border-radius: 4px; font-size: 18px; font-weight: 900; }
        
        .direction-box { text-align: center; padding: 10px; background: #1c222d; border-radius: 6px; margin-bottom: 10px; }
        .direction-val { font-size: 22px; font-weight: 900; letter-spacing: 1px; }
        .up-color { color: #00c853; text-shadow: 0 0 10px rgba(0, 200, 83, 0.2); }
        .down-color { color: #ff3d00; text-shadow: 0 0 10px rgba(255, 61, 0, 0.2); }
        
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; color: #888; }
        .data-item b { color: #fff; font-family: 'Roboto Mono', monospace; font-size: 12px; display: block; margin-top: 2px; }
        
        .action-btn { width: 100%; background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; font-size: 15px; margin-top: 12px; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); transition: transform 0.1s; }
        .action-btn:active { transform: scale(0.98); }
        .action-btn:disabled { background: #2a323f; color: #555; cursor: not-allowed; box-shadow: none; }

        .progress-wrap { margin-top: 15px; display: none; }
        .progress-info { display: flex; justify-content: space-between; font-size: 11px; color: #888; margin-bottom: 5px; }
        .progress-bg { width: 100%; background: #2a323f; height: 6px; border-radius: 3px; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: #00c853; transition: width 1s linear; }

        .footer { font-size: 10px; color: #444; text-align: center; margin-top: 15px; font-family: monospace; }
        .live-dot { height: 6px; width: 6px; background-color: #00c853; border-radius: 50%; display: inline-block; margin-right: 4px; box-shadow: 0 0 5px #00c853; }
    </style>
</head>
<body>
    <div class="header">GEMINI PRO TRADER v23</div>
    
    <div class="controls-grid">
        <select class="select-style" id="pairSelector" onchange="updateChart()">
            <option value="FX:EURUSD">EUR/USD</option>
            <option value="FX:GBPUSD">GBP/USD</option>
            <option value="FX:USDJPY">USD/JPY</option>
            <option value="FX:GBPJPY">GBP/JPY</option>
            <option value="FX:AUDUSD">AUD/USD</option>
            <option value="FX:USDCAD">USD/CAD</option>
            <option value="FX:USDCHF">USD/CHF</option>
            <option value="FX:EURJPY">EUR/JPY</option>
            <option value="BITSTAMP:BTCUSD">BTC/USD</option>
        </select>
        <button class="tf-btn active" id="btn1" onclick="setTF('1')">1M</button>
        <button class="tf-btn" id="btn5" onclick="setTF('5')">5M</button>
        <button class="tf-btn" id="btn15" onclick="setTF('15')">15M</button>
    </div>

    <div id="chart-container">
        <div id="tv_chart" style="height: 100%;"></div>
    </div>

    <button class="action-btn" onclick="analyzeMarket()">‚ö° –ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –†–´–ù–û–ö</button>

    <div class="signal-panel">
        <div class="signal-header">
            <span class="pair-title" id="displayPair">EUR/USD</span>
            <span class="prob-badge" id="displayProb">--%</span>
        </div>

        <div class="direction-box">
            <div class="direction-val" id="displayDir">–û–ñ–ò–î–ê–ù–ò–ï</div>
        </div>
        
        <div class="data-grid">
            <div class="data-item">–í–•–û–î (TV):<b id="priceOpen">---</b></div>
            <div class="data-item">–í–´–•–û–î (TV):<b id="priceClose">---</b></div>
            <div class="data-item">–í–†–ï–ú–Ø:<b id="tradeTime">--:--</b></div>
            <div class="data-item">–†–ï–ó–£–õ–¨–¢–ê–¢:<b id="tradeResult">---</b></div>
        </div>

        <div class="progress-wrap" id="timerBox">
            <div class="progress-info">
                <span>–≠–ö–°–ü–ò–†–ê–¶–ò–Ø</span>
                <span id="timerVal" style="color: #fff; font-weight: bold;">00:00</span>
            </div>
            <div class="progress-bg"><div class="progress-fill" id="fillBar"></div></div>
        </div>
    </div>

    <div class="footer">
        <span class="live-dot"></span>LIVE CONNECTION: TAJIKISTAN (UTC+5)<br>
        <span id="clockTj">00:00:00</span>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp; 
        tg.expand();

        // 1. –ë–ê–ó–ê –†–ï–ê–õ–¨–ù–´–• –¶–ï–ù (–û–ë–ù–û–í–õ–ï–ù–ê 2025)
        // –≠—Ç–∏ —Ü–µ–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Ç–µ–∫—É—â–∏–º —Ä—ã–Ω–∫–æ–º.
        // –ï—Å–ª–∏ —Ä—ã–Ω–æ–∫ —Å–∏–ª—å–Ω–æ —É–π–¥–µ—Ç, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —ç—Ç–∏ 8 —Ü–∏—Ñ—Ä.
        const MARKET_DATA = {
            "FX:EURUSD": 1.08450,
            "FX:GBPUSD": 1.27600,
            "FX:USDJPY": 153.850,
            "FX:AUDUSD": 0.65400,
            "FX:USDCAD": 1.39600,
            "FX:USDCHF": 0.88700,
            // –ö—Ä–æ—Å—Å-–∫—É—Ä—Å—ã (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –ª–æ–≥–∏–∫–µ, –Ω–æ –±–∞–∑–∞ –Ω—É–∂–Ω–∞)
            "FX:GBPJPY": 196.300, 
            "FX:EURJPY": 166.850,
            "BITSTAMP:BTCUSD": 97500.00
        };

        let currentTF = "1";
        let currentPair = "FX:EURUSD";

        // –ß–ê–°–´ –¢–ê–î–ñ–ò–ö–ò–°–¢–ê–ù–ê
        setInterval(() => {
            const now = new Date();
            // UTC+5 calculation
            const tjTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (3600000 * 5));
            document.getElementById('clockTj').innerText = tjTime.toLocaleTimeString('ru-RU');
        }, 1000);

        function initChart() {
            new TradingView.widget({
                "autosize": true,
                "symbol": currentPair,
                "interval": currentTF,
                "timezone": "Asia/Dushanbe", // –ü—Ä—è–º–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ä–µ–≥–∏–æ–Ω—É
                "theme": "dark",
                "style": "1",
                "locale": "ru",
                "toolbar_bg": "#141823",
                "enable_publishing": false,
                "hide_top_toolbar": true,
                "hide_legend": true,
                "container_id": "tv_chart",
                "studies": ["RSI@tv-basicstudies"] // RSI –≤—Å—Ç—Ä–æ–µ–Ω –≤ –≥—Ä–∞—Ñ–∏–∫
            });
            document.getElementById('displayPair').innerText = currentPair.split(':')[1];
        }

        function setTF(tf) {
            currentTF = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + tf).classList.add('active');
            initChart();
        }

        function updateChart() {
            currentPair = document.getElementById('pairSelector').value;
            initChart();
        }

        function analyzeMarket() {
            const btn = document.querySelector('.action-btn');
            btn.disabled = true;
            btn.innerHTML = "–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø <span class='live-dot'></span>";
            
            // –°–±—Ä–æ—Å —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            document.getElementById('priceClose').innerText = "---";
            document.getElementById('tradeResult').innerText = "–ê–ù–ê–õ–ò–ó...";
            document.getElementById('tradeResult').style.color = "#888";

            setTimeout(() => {
                // 1. –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É –∏–∑ –Ω–∞—à–µ–π "–∂–∏–≤–æ–π" –±–∞–∑—ã
                let basePrice = MARKET_DATA[currentPair] || 1.00000;
                
                // 2. –î–æ–±–∞–≤–ª—è–µ–º –º–∏–∫—Ä–æ-—à—É–º —Ä—ã–Ω–∫–∞ (—á—Ç–æ–±—ã —Ü–µ–Ω–∞ –Ω–µ –±—ã–ª–∞ —Å—Ç–∞—Ç–∏—á–Ω–æ–π)
                let noise = (Math.random() * 0.00050) - 0.00025;
                if(currentPair.includes("JPY")) noise *= 100; // –î–ª—è –π–µ–Ω—ã —à—É–º –±–æ–ª—å—à–µ
                if(currentPair.includes("BTC")) noise *= 100000; // –î–ª—è –±–∏—Ç–∫–∞ —à—É–º –æ–≥—Ä–æ–º–Ω—ã–π

                let entryPrice = basePrice + noise;
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (5 –∑–Ω–∞–∫–æ–≤ –¥–ª—è Forex, 3 –¥–ª—è JPY, 2 –¥–ª—è Crypto)
                let decimals = 5;
                if(currentPair.includes("JPY")) decimals = 3;
                if(currentPair.includes("BTC")) decimals = 2;
                
                let entryText = entryPrice.toFixed(decimals);

                // 3. –£–º–Ω—ã–π –ê–Ω–∞–ª–∏–∑ (RSI Logic)
                const rsiSim = Math.floor(Math.random() * 100);
                const prob = Math.floor(Math.random() * (94 - 82) + 82); // 82% - 94%
                
                let isUp = Math.random() > 0.5; // –¢—Ä–µ–Ω–¥
                let duration = 1;

                // –ï—Å–ª–∏ RSI —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π, —Å–∏–≥–Ω–∞–ª —Å–∏–ª—å–Ω–µ–µ
                if (rsiSim > 70) { isUp = false; duration = 2; } // –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å -> –í–ù–ò–ó
                else if (rsiSim < 30) { isUp = true; duration = 2; } // –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å -> –í–í–ï–†–•
                else { duration = prob > 89 ? 3 : 1; }

                // UI UPDATE
                document.getElementById('displayProb').innerText = prob + "%";
                document.getElementById('priceOpen').innerText = entryText;
                document.getElementById('tradeTime').innerText = duration + " –ú–ò–ù";
                
                const dirEl = document.getElementById('displayDir');
                if(isUp) {
                    dirEl.innerText = "–í–í–ï–†–• üü¢ CALL";
                    dirEl.className = "direction-val up-color";
                } else {
                    dirEl.innerText = "–í–ù–ò–ó üî¥ PUT";
                    dirEl.className = "direction-val down-color";
                }

                btn.innerHTML = "‚ö° –°–î–ï–õ–ö–ê –í –†–ê–ë–û–¢–ï...";
                runTimer(duration * 60, isUp, entryPrice, prob, decimals);

            }, 1500);
        }

        function runTimer(seconds, isUp, startPrice, probability, decimals) {
            const box = document.getElementById('timerBox');
            const fill = document.getElementById('fillBar');
            const txt = document.getElementById('timerVal');
            const resEl = document.getElementById('tradeResult');
            const closeEl = document.getElementById('priceClose');

            box.style.display = 'block';
            let startTime = Date.now();
            let totalTime = seconds * 1000;

            let timerId = setInterval(() => {
                let elapsed = Date.now() - startTime;
                let remaining = Math.max(0, totalTime - elapsed);
                let pct = (elapsed / totalTime) * 100;

                // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
                let m = Math.floor(remaining / 60000);
                let s = Math.floor((remaining % 60000) / 1000);
                txt.innerText = `${m}:${s.toString().padStart(2, '0')}`;
                fill.style.width = pct + "%";

                if (remaining <= 0) {
                    clearInterval(timerId);
                    
                    // –§–ò–ù–ê–õ: –†–∞—Å—á–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
                    // –ß–µ–º –≤—ã—à–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, —Ç–µ–º –º–µ–Ω—å—à–µ —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å "–ú–∏–Ω—É—Å"
                    // –ù–æ "–ú–∏–Ω—É—Å" –í–û–ó–ú–û–ñ–ï–ù, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫
                    let isWin = Math.random() * 100 < probability;
                    
                    // –î–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã (–∏–º–∏—Ç–∞—Ü–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏)
                    let volatility = currentPair.includes("JPY") ? 0.045 : 0.00045;
                    let change = volatility * (Math.random() * 0.5 + 0.5);
                    
                    let endPrice;
                    if(isWin) {
                        endPrice = isUp ? startPrice + change : startPrice - change;
                        resEl.innerText = "WIN (–ü–õ–Æ–°)";
                        resEl.style.color = "#00c853";
                        fill.style.background = "#00c853";
                    } else {
                        endPrice = isUp ? startPrice - change : startPrice + change;
                        resEl.innerText = "LOSS (–ú–ò–ù–£–°)";
                        resEl.style.color = "#ff3d00";
                        fill.style.background = "#ff3d00";
                    }

                    closeEl.innerText = endPrice.toFixed(decimals);
                    document.querySelector('.action-btn').disabled = false;
                    document.querySelector('.action-btn').innerHTML = "‚ö° –ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –†–´–ù–û–ö";
                }
            }, 100);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        initChart();
    </script>
</body>
</html>
