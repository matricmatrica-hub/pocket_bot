<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pocket Turbo Terminal</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background: #0e1217; color: #ffffff; margin: 0; padding: 10px; overflow-x: hidden; }
        .header { text-align: center; padding: 5px; color: #00a2ff; font-size: 16px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        
        .controls-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .select-style { background: #1c222d; color: white; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 2; font-size: 14px; outline: none; }
        .tf-btn { background: #1c222d; color: #848e9c; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 1; cursor: pointer; font-size: 13px; font-weight: bold; }
        .tf-btn.active { background: #00a2ff; color: white; border-color: #00a2ff; }
        
        #chart-box { height: 300px; background: #141823; border-radius: 12px; border: 1px solid #2a2e39; position: relative; overflow: hidden; }
        
        .signal-info { background: #1c222d; border-radius: 12px; padding: 15px; margin-top: 12px; border-top: 4px solid #303948; position: relative; }
        .pair-name { font-size: 18px; font-weight: bold; color: #ffffff; }
        .probability { position: absolute; right: 15px; top: 12px; font-size: 24px; font-weight: 800; color: #00c853; }
        
        /* –ö–Ω–æ–ø–∫–∞ –ü–û–õ–£–ß–ò–¢–¨ –°–ò–ì–ù–ê–õ */
        .get-signal-btn { width: 100%; background: #00a2ff; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 162, 255, 0.3); }
        .get-signal-btn:active { transform: scale(0.98); background: #008cdb; }

        .timer-box { width: 100%; background: #2a323f; height: 6px; border-radius: 10px; margin-top: 15px; display: none; overflow: hidden; }
        .timer-fill { width: 0%; height: 100%; background: #00c853; box-shadow: 0 0 10px #00c853; transition: width 0.1s linear; }
        #status-msg { font-size: 13px; color: #848e9c; margin-top: 8px; display: block; text-align: center; }
    </style>
</head>
<body>
    <div class="header">Pocket Turbo Terminal</div>
    
    <div class="controls-row">
        <select class="select-style" id="pairSelector" onchange="updateChart()">
            <option value="FX:EURUSD">EUR/USD</option>
            <option value="FX:GBPUSD">GBP/USD</option>
            <option value="FX:AUDUSD">AUD/USD</option>
            <option value="FX:USDCAD">USD/CAD</option>
            <option value="FX:AUDCAD">AUD/CAD</option>
            <option value="FX:CADCHF">CAD/CHF</option>
            <option value="FX:EURCAD">EUR/CAD</option>
            <option value="FX:EURGBP">EUR/GBP</option>
            <option value="FX:CADJPY">CAD/JPY</option>
            <option value="BITSTAMP:BTCUSD">BTC/USD</option>
        </select>
        <button class="tf-btn active" id="btn1" onclick="setTF('1')">1M</button>
        <button class="tf-btn" id="btn5" onclick="setTF('5')">5M</button>
        <button class="tf-btn" id="btn15" onclick="setTF('15')">15M</button>
    </div>

    <div id="chart-box">
        <div id="tv_chart_container" style="height: 100%;"></div>
    </div>

    <button class="get-signal-btn" onclick="requestManualSignal()">üéØ –ü–û–õ–£–ß–ò–¢–¨ –°–ò–ì–ù–ê–õ</button>

    <div class="signal-info" id="signalCard">
        <div class="probability" id="probText">--%</div>
        <div class="pair-name" id="pairName">–ê–ù–ê–õ–ò–ó–ê–¢–û–†</div>
        <div id="status-msg">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—É –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ</div>
        
        <div class="timer-box" id="timerContainer">
            <div class="timer-fill" id="timerBar"></div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let currentTF = "1";
        let currentPair = "FX:EURUSD";

        function updateChart() {
            currentPair = document.getElementById('pairSelector').value;
            new TradingView.widget({
                "autosize": true, "symbol": currentPair, "interval": currentTF,
                "timezone": "Etc/UTC", "theme": "dark", "style": "1", "locale": "ru",
                "hide_top_toolbar": true, "hide_legend": true, "container_id": "tv_chart_container"
            });
            document.getElementById('pairName').innerText = currentPair.split(':')[1].replace('USD', '/USD');
        }

        function setTF(tf) {
            currentTF = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + tf).classList.add('active');
            updateChart();
        }

        function requestManualSignal() {
            const btn = document.querySelector('.get-signal-btn');
            btn.innerText = "–ê–ù–ê–õ–ò–ó–£–Æ...";
            btn.disabled = true;
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–æ—Ç—É
            setTimeout(() => {
                const prob = Math.floor(Math.random() * (92 - 70 + 1)) + 70;
                document.getElementById('probText').innerText = prob + "%";
                document.getElementById('status-msg').innerHTML = "–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø: <b style='color:#00c853'>–í–í–ï–†–• (CALL)</b>";
                btn.innerText = "üéØ –ü–û–õ–£–ß–ò–¢–¨ –°–ò–ì–ù–ê–õ";
                btn.disabled = false;
                startProgress(60); // –ó–∞–ø—É—Å–∫ –ø–æ–ª–∑—É–Ω–∫–∞ –Ω–∞ 60 —Å–µ–∫
            }, 1500);
        }

        function startProgress(seconds) {
            const container = document.getElementById('timerContainer');
            const bar = document.getElementById('timerBar');
            container.style.display = 'block';
            let start = Date.now();
            let duration = seconds * 1000;
            let interval = setInterval(() => {
                let progress = ((Date.now() - start) / duration) * 100;
                if (progress >= 100) {
                    bar.style.width = '100%';
                    clearInterval(interval);
                    document.getElementById('status-msg').innerHTML = "–ò–¢–û–ì: <b style='color:#00c853'>‚úÖ –ü–õ–Æ–°</b>";
                } else { bar.style.width = progress + '%'; }
            }, 100);
        }

        updateChart();
    </script>
</body>
</html>
