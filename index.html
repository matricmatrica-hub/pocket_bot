<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini AI Core v26</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background: #0b0e11; color: #e1e1e1; margin: 0; padding: 12px; overflow-x: hidden; }
        .header { text-align: center; padding: 8px; color: #00a2ff; font-size: 13px; font-weight: 900; letter-spacing: 1.5px; text-transform: uppercase; border-bottom: 1px solid #1c222d; margin-bottom: 15px; }
        
        /* Control Panel */
        .controls-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 6px; margin-bottom: 12px; }
        .select-style { background: #1c222d; color: #fff; border: 1px solid #2a323f; padding: 0 10px; border-radius: 6px; font-size: 13px; outline: none; height: 40px; }
        .tf-btn { background: #1c222d; color: #777; border: 1px solid #2a323f; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: bold; transition: 0.2s; height: 40px; }
        .tf-btn.active { background: #00a2ff; color: #fff; border-color: #00a2ff; box-shadow: 0 2px 8px rgba(0, 162, 255, 0.2); }
        
        #chart-container { height: 260px; background: #141823; border-radius: 8px; border: 1px solid #2a2e39; overflow: hidden; margin-bottom: 12px; }
        
        /* AI Log Console */
        .ai-console { background: #000; border: 1px solid #333; border-radius: 6px; padding: 8px; font-family: 'Courier New', monospace; font-size: 10px; color: #00ff00; height: 60px; overflow: hidden; margin-bottom: 10px; opacity: 0.8; }
        .log-line { margin: 2px 0; }

        /* Signal Panel */
        .signal-panel { background: #151a21; border-radius: 8px; padding: 15px; border: 1px solid #2a323f; position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #2a323f; padding-bottom: 8px; }
        .pair-title { font-size: 16px; font-weight: bold; color: #fff; }
        .prob-badge { background: rgba(0, 200, 83, 0.15); color: #00c853; padding: 4px 8px; border-radius: 4px; font-size: 18px; font-weight: 900; }
        
        .direction-box { text-align: center; padding: 12px; background: #1c222d; border-radius: 6px; margin-bottom: 10px; border: 1px solid #2a323f; }
        .direction-val { font-size: 24px; font-weight: 900; letter-spacing: 1px; }
        .up-color { color: #00c853; text-shadow: 0 0 15px rgba(0, 200, 83, 0.3); }
        .down-color { color: #ff3d00; text-shadow: 0 0 15px rgba(255, 61, 0, 0.3); }
        
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; color: #888; }
        .data-item b { color: #fff; font-family: 'Roboto Mono', monospace; font-size: 12px; display: block; margin-top: 2px; }
        
        .action-btn { width: 100%; background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; font-size: 15px; margin-top: 12px; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); }
        .action-btn:disabled { background: #2a323f; color: #555; cursor: not-allowed; box-shadow: none; }

        .progress-wrap { margin-top: 15px; display: none; }
        .progress-bg { width: 100%; background: #2a323f; height: 6px; border-radius: 3px; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: #00c853; transition: width 1s linear; }

        .footer { font-size: 10px; color: #444; text-align: center; margin-top: 15px; font-family: monospace; }
        .live-dot { height: 6px; width: 6px; background-color: #00c853; border-radius: 50%; display: inline-block; margin-right: 4px; box-shadow: 0 0 5px #00c853; }
        #api-status { color: #00c853; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">GEMINI AI CORE v26</div>
    
    <div class="controls-grid">
        <select class="select-style" id="pairSelector" onchange="updateChart()">
            <option value="FX:GBPJPY">GBP/JPY</option><option value="FX:AUDCHF">AUD/CHF</option>
            <option value="FX:AUDJPY">AUD/JPY</option><option value="FX:AUDUSD">AUD/USD</option>
            <option value="FX:CADJPY">CAD/JPY</option><option value="FX:CHFJPY">CHF/JPY</option>
            <option value="FX:EURAUD">EUR/AUD</option><option value="FX:EURCHF">EUR/CHF</option>
            <option value="FX:EURUSD">EUR/USD</option><option value="FX:GBPAUD">GBP/AUD</option>
            <option value="FX:GBPCAD">GBP/CAD</option><option value="FX:GBPCHF">GBP/CHF</option>
            <option value="FX:USDCHF">USD/CHF</option><option value="FX:USDJPY">USD/JPY</option>
            <option value="FX:USDCAD">USD/CAD</option><option value="FX:EURJPY">EUR/JPY</option>
            <option value="FX:EURCAD">EUR/CAD</option><option value="FX:AUDCAD">AUD/CAD</option>
            <option value="FX:CADCHF">CAD/CHF</option><option value="FX:EURGBP">EUR/GBP</option>
            <option value="FX:GBPUSD">GBP/USD</option>
        </select>
        <button class="tf-btn active" id="btn1" onclick="setTF('1')">1M</button>
        <button class="tf-btn" id="btn5" onclick="setTF('5')">5M</button>
        <button class="tf-btn" id="btn15" onclick="setTF('15')">15M</button>
    </div>

    <div id="chart-container">
        <div id="tv_chart" style="height: 100%;"></div>
    </div>

    <div class="ai-console" id="aiLog">
        <div class="log-line">> SYSTEM READY...</div>
        <div class="log-line">> WAITING FOR COMMAND...</div>
    </div>

    <button class="action-btn" onclick="startDeepScan()">‚ö° AI DEEP SCAN (START)</button>

    <div class="signal-panel">
        <div class="signal-header">
            <span class="pair-title" id="displayPair">GBP/JPY</span>
            <span class="prob-badge" id="displayProb">--%</span>
        </div>

        <div class="direction-box">
            <div class="direction-val" id="displayDir">–ù–ï–ê–ö–¢–ò–í–ï–ù</div>
        </div>
        
        <div class="data-grid">
            <div class="data-item">–í–•–û–î:<b id="priceOpen">---</b></div>
            <div class="data-item">–í–´–•–û–î:<b id="priceClose">---</b></div>
            <div class="data-item">–ò–¢–û–ì:<b id="tradeResult">---</b></div>
            <div class="data-item">–¢–ê–ô–ú–ï–†:<b id="timerVal">--:--</b></div>
        </div>

        <div class="progress-wrap" id="timerBox">
            <div class="progress-bg"><div class="progress-fill" id="fillBar"></div></div>
        </div>
    </div>

    <div class="footer">
        <span class="live-dot"></span>NEURAL NETWORK: <span id="api-status">CONNECTING...</span><br>
        –í—Ä–µ–º—è (–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω): <span id="clockTj">00:00:00</span>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp; 
        tg.expand();

        let currentTF = "1";
        let currentPair = "FX:GBPJPY";
        let liveRates = {}; 
        let historyRates = {}; // –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞

        // --- –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ---
        function addLog(msg) {
            const log = document.getElementById('aiLog');
            log.innerHTML += `<div class="log-line">> ${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // --- API –ö–£–†–°–û–í ---
        async function fetchLiveRates() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                if(data && data.rates) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º "–∏—Å—Ç–æ—Ä–∏—é" –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–∞ (—Å–∏–º—É–ª—è—Ü–∏—è)
                    historyRates = {...liveRates}; 
                    liveRates = data.rates;
                    
                    document.getElementById('api-status').innerText = "ONLINE (SYNCED)";
                    document.getElementById('api-status').style.color = "#00c853";
                }
            } catch (error) {
                document.getElementById('api-status').innerText = "RETRYING...";
            }
        }
        
        fetchLiveRates();
        setInterval(fetchLiveRates, 60000);

        // --- –ß–ê–°–´ (UTC+5) ---
        setInterval(() => {
            const now = new Date();
            const tjTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (3600000 * 5));
            document.getElementById('clockTj').innerText = tjTime.toLocaleTimeString('ru-RU');
        }, 1000);

        function initChart() {
            new TradingView.widget({
                "autosize": true, "symbol": currentPair, "interval": currentTF,
                "timezone": "Asia/Dushanbe", "theme": "dark", "style": "1", "locale": "ru",
                "hide_top_toolbar": true, "hide_legend": true, "container_id": "tv_chart",
                "studies": ["RSI@tv-basicstudies", "MASimple@tv-basicstudies"] // –î–æ–±–∞–≤–∏–ª–∏ MA
            });
            document.getElementById('displayPair').innerText = currentPair.split(':')[1];
        }

        function setTF(tf) {
            currentTF = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + tf).classList.add('active');
            initChart();
        }

        function updateChart() {
            currentPair = document.getElementById('pairSelector').value;
            initChart();
            document.getElementById('aiLog').innerHTML = `<div class="log-line">> PAIR CHANGED TO ${currentPair}</div>`;
        }

        function getExactPrice(pair) {
            if (!liveRates.EUR) return 0;
            const symbol = pair.split(':')[1]; 
            const base = symbol.substring(0, 3); 
            const quote = symbol.substring(3, 6); 
            let price = 0;
            if (base === 'USD') price = liveRates[quote];
            else price = (1 / liveRates[base]) * liveRates[quote];
            return price;
        }

        // --- –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–´–ô –°–ö–ê–ù ---
        function startDeepScan() {
            const btn = document.querySelector('.action-btn');
            btn.disabled = true;
            btn.innerHTML = "SCANNING...";
            
            document.getElementById('aiLog').innerHTML = ""; // –û—á–∏—Å—Ç–∫–∞
            addLog(`INITIALIZING AI CORE v26...`);
            addLog(`TARGET: ${currentPair}`);

            let step = 0;
            const scanInterval = setInterval(() => {
                step++;
                if (step === 1) addLog("FETCHING REAL-TIME DATA (API)...");
                if (step === 2) addLog("ANALYZING RSI & STOCHASTIC...");
                if (step === 3) addLog("CHECKING MARKET VOLATILITY...");
                if (step === 4) addLog("CALCULATING PROBABILITY...");
                
                if (step === 5) {
                    clearInterval(scanInterval);
                    generateSmartSignal();
                }
            }, 400); // –°–∫–æ—Ä–æ—Å—Ç—å –ª–æ–≥–æ–≤
        }

        function generateSmartSignal() {
            let realPrice = getExactPrice(currentPair);
            if(realPrice === 0) realPrice = currentPair.includes("JPY") ? 150.00 : 1.1000;

            // 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ (–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑)
            // –ú—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É —Å "–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π" (—Å–∏–º—É–ª—è—Ü–∏—è)
            // –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ü–µ–Ω–∞ (historyRates) –±—ã–ª–∞ –Ω–∏–∂–µ, –∑–Ω–∞—á–∏—Ç —Ç—Ä–µ–Ω–¥ –í–í–ï–†–•
            let prevPrice = realPrice * (1 - (Math.random() * 0.001 - 0.0005)); 
            let trendUp = realPrice > prevPrice;
            
            addLog(`TREND DETECTED: ${trendUp ? 'BULLISH (UP)' : 'BEARISH (DOWN)'}`);

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ RSI
            // –ï—Å–ª–∏ —Ç—Ä–µ–Ω–¥ –í–í–ï–†–•, –Ω–æ RSI > 80 (–ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å), –º—ã –ù–ï –∏–¥–µ–º –≤–≤–µ—Ä—Ö, –º—ã –∏–¥–µ–º –í–ù–ò–ó (—Ä–∞–∑–≤–æ—Ä–æ—Ç)
            let rsiVal = Math.floor(Math.random() * 100);
            addLog(`RSI INDICATOR: ${rsiVal}`);

            let signalUp = trendUp;
            let signalType = "FOLLOW TREND";

            if (trendUp && rsiVal > 75) {
                signalUp = false; // –†–∞–∑–≤–æ—Ä–æ—Ç –≤–Ω–∏–∑
                signalType = "REVERSAL (OVERBOUGHT)";
            } else if (!trendUp && rsiVal < 25) {
                signalUp = true; // –†–∞–∑–≤–æ—Ä–æ—Ç –≤–≤–µ—Ä—Ö
                signalType = "REVERSAL (OVERSOLD)";
            }

            addLog(`STRATEGY: ${signalType}`);

            // 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
            let noise = realPrice * (Math.random() * 0.0002 - 0.0001);
            let entryPrice = realPrice + noise;
            let decimals = currentPair.includes("JPY") ? 3 : 5;
            
            // –†–∞—Å—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (Probability)
            let confidence = 80 + Math.floor(Math.random() * 15); // 80-95%
            // –ï—Å–ª–∏ —Å–∏–≥–Ω–∞–ª "–°–ª–∞–±—ã–π" (RSI –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ 40-60), —É–º–µ–Ω—å—à–∞–µ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
            if (rsiVal > 40 && rsiVal < 60) confidence -= 5;

            // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            let duration = confidence > 88 ? 3 : 1; 

            // UI
            document.getElementById('displayProb').innerText = confidence + "%";
            document.getElementById('priceOpen').innerText = entryPrice.toFixed(decimals);
            
            const dirEl = document.getElementById('displayDir');
            dirEl.innerText = signalUp ? "–í–í–ï–†–• üü¢" : "–í–ù–ò–ó üî¥";
            dirEl.className = "direction-val " + (signalUp ? "up-color" : "down-color");

            document.querySelector('.action-btn').innerHTML = "–°–î–ï–õ–ö–ê –í –†–ê–ë–û–¢–ï";
            addLog(`SIGNAL LOCKED: ${signalUp ? 'CALL' : 'PUT'} | CONFIDENCE: ${confidence}%`);
            
            runTimer(duration * 60, signalUp, entryPrice, confidence, decimals);
        }

        function runTimer(seconds, isUp, startPrice, probability, decimals) {
            const box = document.getElementById('timerBox');
            const fill = document.getElementById('fillBar');
            const txt = document.getElementById('timerVal');
            const resEl = document.getElementById('tradeResult');
            const closeEl = document.getElementById('priceClose');

            box.style.display = 'block';
            let startTime = Date.now();
            let totalTime = seconds * 1000;

            let timerId = setInterval(() => {
                let elapsed = Date.now() - startTime;
                let remaining = totalTime - elapsed;
                let pct = (elapsed / totalTime) * 100;

                if (remaining <= 0) {
                    clearInterval(timerId);
                    txt.innerText = "00:00";
                    fill.style.width = "100%";
                    
                    // –£–º–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
                    // –ï—Å–ª–∏ Confidence > 90%, —à–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É –æ—á–µ–Ω—å –≤—ã—Å–æ–∫
                    // –ï—Å–ª–∏ 75%, –µ—Å—Ç—å —Ä–∏—Å–∫
                    let isWin = Math.random() * 100 < probability;
                    
                    // –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
                    let move = startPrice * 0.0004; 
                    let change = move * (Math.random() + 0.2);
                    
                    let endPrice;
                    if(isWin) {
                         endPrice = isUp ? startPrice + change : startPrice - change;
                         resEl.innerText = "‚úÖ WIN";
                         resEl.style.color = "#00c853";
                         fill.style.background = "#00c853";
                         addLog("RESULT: PROFIT DETECTED");
                    } else {
                         endPrice = isUp ? startPrice - change : startPrice + change;
                         resEl.innerText = "‚ùå LOSS";
                         resEl.style.color = "#ff3d00";
                         fill.style.background = "#ff3d00";
                         addLog("RESULT: MARKET REVERSAL (LOSS)");
                    }
                    closeEl.innerText = endPrice.toFixed(decimals);
                    
                    document.querySelector('.action-btn').disabled = false;
                    document.querySelector('.action-btn').innerText = "‚ö° –ù–û–í–´–ô –°–ö–ê–ù";
                } else {
                    let m = Math.floor(remaining / 60000);
                    let s = Math.floor((remaining % 60000) / 1000);
                    txt.innerText = `${m}:${s.toString().padStart(2, '0')}`;
                    fill.style.width = pct + "%";
                }
            }, 100);
        }

        initChart();
    </script>
</body>
</html>
