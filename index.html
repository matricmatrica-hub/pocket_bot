<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini ULTIMATE v30</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* FINAL PRO DESIGN */
        :root { --accent: #00f2ff; --bg: #050505; --card: #111; --text: #e0e0e0; --win: #00ff88; --loss: #ff004c; }
        body { font-family: 'Roboto', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; overflow-x: hidden; }
        
        .header { text-align: center; padding: 12px; color: var(--accent); font-size: 16px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; border-bottom: 1px solid #222; margin-bottom: 15px; text-shadow: 0 0 15px rgba(0, 242, 255, 0.3); }
        
        /* CONTROLS */
        .controls-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .select-style { background: #1a1a1a; color: #fff; border: 1px solid #333; padding: 0 10px; border-radius: 6px; font-size: 13px; outline: none; height: 44px; font-weight: bold; }
        .tf-btn { background: #1a1a1a; color: #666; border: 1px solid #333; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: bold; transition: 0.3s; height: 44px; }
        .tf-btn.active { background: rgba(0, 242, 255, 0.1); color: var(--accent); border-color: var(--accent); box-shadow: 0 0 10px rgba(0, 242, 255, 0.2); }
        
        #chart-container { height: 260px; background: #0f0f0f; border-radius: 12px; border: 1px solid #222; overflow: hidden; margin-bottom: 15px; position: relative; }
        
        /* NEURAL DASHBOARD */
        .neural-panel { background: #111; border-radius: 12px; padding: 15px; border: 1px solid #222; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .indicators-row { display: flex; justify-content: space-between; margin-bottom: 15px; background: #080808; padding: 8px; border-radius: 8px; }
        .ind-box { text-align: center; font-size: 10px; color: #555; flex: 1; border-right: 1px solid #222; }
        .ind-box:last-child { border-right: none; }
        .ind-val { display: block; font-size: 12px; font-weight: bold; color: #fff; margin-top: 2px; }
        
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .pair-title { font-size: 20px; font-weight: 900; color: #fff; }
        .confidence-badge { background: #1a1a1a; border: 1px solid #333; color: var(--accent); padding: 4px 10px; border-radius: 4px; font-size: 14px; font-weight: bold; }

        .direction-box { text-align: center; padding: 15px; background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; }
        .direction-val { font-size: 28px; font-weight: 900; letter-spacing: 1.5px; }
        
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 11px; color: #777; }
        .data-item { background: #0a0a0a; padding: 8px; border-radius: 6px; border: 1px solid #222; }
        .data-item b { color: #fff; font-family: 'Roboto Mono', monospace; font-size: 13px; display: block; margin-top: 4px; }
        
        .btn-main { width: 100%; background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 18px; border-radius: 10px; font-weight: 900; font-size: 16px; margin-top: 15px; cursor: pointer; box-shadow: 0 4px 20px rgba(0, 123, 255, 0.3); transition: 0.2s; letter-spacing: 1px; }
        .btn-main:active { transform: scale(0.98); }
        .btn-main:disabled { background: #222; color: #555; cursor: not-allowed; box-shadow: none; }

        /* ANIMATIONS */
        .progress-wrap { margin-top: 15px; display: none; }
        .progress-bg { width: 100%; background: #222; height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: var(--win); transition: width 1s linear; box-shadow: 0 0 10px var(--win); }

        .footer { font-size: 10px; color: #444; text-align: center; margin-top: 20px; font-family: monospace; }
        .dot { height: 6px; width: 6px; background-color: var(--accent); border-radius: 50%; display: inline-block; margin-right: 5px; box-shadow: 0 0 8px var(--accent); }
        
        .up-glow { color: var(--win); text-shadow: 0 0 20px rgba(0, 255, 136, 0.4); }
        .down-glow { color: var(--loss); text-shadow: 0 0 20px rgba(255, 0, 76, 0.4); }
    </style>
</head>
<body>
    <div class="header">GEMINI ULTIMATE v30</div>
    
    <div class="controls-grid">
        <select class="select-style" id="pairSelector" onchange="updateChart()">
            <option value="FX:EURUSD">EUR/USD</option><option value="FX:GBPUSD">GBP/USD</option>
            <option value="FX:USDJPY">USD/JPY</option><option value="FX:GBPJPY">GBP/JPY</option>
            <option value="FX:AUDUSD">AUD/USD</option><option value="FX:USDCAD">USD/CAD</option>
            <option value="FX:USDCHF">USD/CHF</option><option value="FX:EURJPY">EUR/JPY</option>
            <option value="FX:AUDJPY">AUD/JPY</option><option value="FX:CADJPY">CAD/JPY</option>
            <option value="FX:CHFJPY">CHF/JPY</option><option value="FX:EURAUD">EUR/AUD</option>
            <option value="FX:EURCHF">EUR/CHF</option><option value="FX:GBPAUD">GBP/AUD</option>
            <option value="FX:GBPCAD">GBP/CAD</option><option value="FX:GBPCHF">GBP/CHF</option>
            <option value="FX:EURCAD">EUR/CAD</option><option value="FX:AUDCAD">AUD/CAD</option>
            <option value="FX:CADCHF">CAD/CHF</option><option value="FX:EURGBP">EUR/GBP</option>
            <option value="FX:AUDCHF">AUD/CHF</option>
        </select>
        <button class="tf-btn active" id="btn1" onclick="setTF('1')">1M</button>
        <button class="tf-btn" id="btn5" onclick="setTF('5')">5M</button>
        <button class="tf-btn" id="btn15" onclick="setTF('15')">15M</button>
    </div>

    <div class="indicators-row">
        <div class="ind-box">RSI (14)<span class="ind-val" id="indRSI">--</span></div>
        <div class="ind-box">MACD<span class="ind-val" id="indMACD">--</span></div>
        <div class="ind-box">SPREAD<span class="ind-val" id="indSpread">LOW</span></div>
        <div class="ind-box">TREND<span class="ind-val" id="indTrend">--</span></div>
    </div>

    <div id="chart-container">
        <div id="tv_chart" style="height: 100%;"></div>
    </div>

    <button class="btn-main" onclick="startNeuralScan()">–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó (AI)</button>

    <div class="neural-panel">
        <div class="signal-header">
            <span class="pair-title" id="displayPair">EUR/USD</span>
            <span class="confidence-badge" id="displayProb">--%</span>
        </div>

        <div class="direction-box">
            <div class="direction-val" id="displayDir">–ì–û–¢–û–í–ù–û–°–¢–¨</div>
        </div>
        
        <div class="data-grid">
            <div class="data-item">–¶–ï–ù–ê –í–•–û–î–ê:<b id="priceOpen">---</b></div>
            <div class="data-item">–¶–ï–ù–ê –í–´–•–û–î–ê:<b id="priceClose">---</b></div>
            <div class="data-item">–†–ï–ó–£–õ–¨–¢–ê–¢:<b id="tradeResult">---</b></div>
            <div class="data-item">–¢–ê–ô–ú–ï–†:<b id="timerVal">--:--</b></div>
        </div>

        <div class="progress-wrap" id="timerBox">
            <div class="progress-bg"><div class="progress-fill" id="fillBar"></div></div>
        </div>
    </div>

    <div class="footer">
        <span class="dot"></span>LIVE FEED: TAJIKISTAN (UTC+5)<br>
        <span id="clockTj" style="color: #fff; font-weight: bold;">00:00:00</span>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp; 
        tg.expand();

        let currentTF = "1";
        let currentPair = "FX:EURUSD";
        let liveRates = {}; 
        
        // --- LIVE TICK ENGINE (–ò–º–∏—Ç–∞—Ü–∏—è –∂–∏–≤–æ–≥–æ —Ä—ã–Ω–∫–∞) ---
        // –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω–µ "–¥—ã—à–∞—Ç—å" –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ API
        let currentSimulatedPrice = 0;
        
        // --- 1. API CONNECTION ---
        async function fetchLiveRates() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                if(data && data.rates) {
                    liveRates = data.rates;
                }
            } catch (error) { console.log("API Cache used"); }
        }
        fetchLiveRates();
        setInterval(fetchLiveRates, 60000); 

        // --- CLOCK UTC+5 ---
        setInterval(() => {
            const now = new Date();
            const tjTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (3600000 * 5));
            document.getElementById('clockTj').innerText = tjTime.toLocaleTimeString('ru-RU');
        }, 1000);

        function initChart() {
            new TradingView.widget({
                "autosize": true, "symbol": currentPair, "interval": currentTF,
                "timezone": "Asia/Dushanbe", "theme": "dark", "style": "1", "locale": "ru",
                "hide_top_toolbar": true, "hide_legend": true, "container_id": "tv_chart",
                "studies": ["RSI@tv-basicstudies", "MACD@tv-basicstudies"] 
            });
            document.getElementById('displayPair').innerText = currentPair.split(':')[1];
        }

        function setTF(tf) {
            currentTF = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + tf).classList.add('active');
            initChart();
        }

        function updateChart() {
            currentPair = document.getElementById('pairSelector').value;
            initChart();
            // Reset UI
            document.getElementById('displayDir').innerText = "–ì–û–¢–û–í–ù–û–°–¢–¨";
            document.getElementById('displayDir').className = "direction-val";
        }

        function getExactPrice(pair) {
            if (!liveRates.EUR) return 0;
            const symbol = pair.split(':')[1]; 
            const base = symbol.substring(0, 3); 
            const quote = symbol.substring(3, 6); 
            let price = 0;
            if (base === 'USD') price = liveRates[quote];
            else price = (1 / liveRates[base]) * liveRates[quote];
            return price;
        }

        // --- 2. NEURAL SCAN LOGIC ---
        function startNeuralScan() {
            const btn = document.querySelector('.btn-main');
            btn.disabled = true;
            btn.innerHTML = "–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –†–´–ù–ö–ê...";
            
            // –°–±—Ä–æ—Å
            document.getElementById('priceClose').innerText = "---";
            document.getElementById('tradeResult').innerText = "–ê–ù–ê–õ–ò–ó...";
            document.getElementById('tradeResult').style.color = "#777";

            setTimeout(() => {
                // 1. –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É
                let realPrice = getExactPrice(currentPair);
                if(realPrice === 0) realPrice = currentPair.includes("JPY") ? 150.00 : 1.1000;
                
                // 2. –î–æ–±–∞–≤–ª—è–µ–º "–î—ã—Ö–∞–Ω–∏–µ" (Spread correction)
                // –ï—Å–ª–∏ –º—ã –ø–æ–∫—É–ø–∞–µ–º (CALL), —Ü–µ–Ω–∞ —á—É—Ç—å –≤—ã—à–µ (Ask). –ï—Å–ª–∏ –ø—Ä–æ–¥–∞–µ–º (PUT) - —á—É—Ç—å –Ω–∏–∂–µ (Bid).
                // –ù–æ –º—ã –ø–æ–∫–∞ –Ω–µ –∑–Ω–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ. –°–Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑.

                // –ê–ù–ê–õ–ò–ó –ò–ù–î–ò–ö–ê–¢–û–†–û–í
                let rsi = Math.floor(Math.random() * (75 - 25) + 25); // 25-75 range simulation
                let macd = (Math.random() > 0.5) ? "BUY" : "SELL";
                let trend = (Math.random() > 0.5) ? "UP" : "DOWN";
                
                // –õ–æ–≥–∏–∫–∞ —Ä–µ—à–µ–Ω–∏—è
                let score = 0; // –ë–∞–ª–ª—ã –∑–∞ —Å–∏–≥–Ω–∞–ª –í–í–ï–†–•
                if (rsi < 35) score += 2; // –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å
                if (rsi > 65) score -= 2; // –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å
                if (macd === "BUY") score += 1; else score -= 1;
                if (trend === "UP") score += 1; else score -= 1;
                
                let isUp = score > 0;
                
                // 3. –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –°–ü–†–ï–î–ê (–¢–µ —Å–∞–º—ã–µ "10 –ø—É–Ω–∫—Ç–æ–≤")
                // –ú—ã —Å–¥–≤–∏–≥–∞–µ–º —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ "–Ω–µ –≤ –Ω–∞—à—É –ø–æ–ª—å–∑—É", –∫–∞–∫ –¥–µ–ª–∞–µ—Ç –±—Ä–æ–∫–µ—Ä
                let spread = realPrice * 0.00010; // ~10 –ø—É–Ω–∫—Ç–æ–≤
                let entryPrice = isUp ? (realPrice + spread) : (realPrice - spread);
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                let decimals = currentPair.includes("JPY") ? 3 : 5;
                let entryText = entryPrice.toFixed(decimals);

                // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (Confidence)
                let confidence = 83 + Math.abs(score) * 4; // 83% –±–∞–∑–∞ + –±–æ–Ω—É—Å—ã –∑–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
                if (confidence > 96) confidence = 96;

                // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                let duration = confidence > 90 ? 3 : 1;

                // UI INDICATORS UPDATE
                document.getElementById('indRSI').innerText = rsi;
                document.getElementById('indMACD').innerText = macd;
                document.getElementById('indTrend').innerText = trend;
                document.getElementById('indSpread').innerText = "OK";
                document.getElementById('indSpread').style.color = "#00c853";

                // MAIN UI UPDATE
                document.getElementById('displayProb').innerText = confidence + "%";
                document.getElementById('priceOpen').innerText = entryText;
                
                const dirEl = document.getElementById('displayDir');
                if (isUp) {
                    dirEl.innerText = "–í–í–ï–†–• üü¢ (CALL)";
                    dirEl.className = "direction-val up-glow";
                } else {
                    dirEl.innerText = "–í–ù–ò–ó üî¥ (PUT)";
                    dirEl.className = "direction-val down-glow";
                }

                btn.innerText = "–°–î–ï–õ–ö–ê –í –†–ê–ë–û–¢–ï";
                runTimer(duration * 60, isUp, entryPrice, confidence, decimals);

            }, 2000); // 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ "–≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑"
        }

        function runTimer(seconds, isUp, startPrice, probability, decimals) {
            const box = document.getElementById('timerBox');
            const fill = document.getElementById('fillBar');
            const txt = document.getElementById('timerVal');
            const resEl = document.getElementById('tradeResult');
            const closeEl = document.getElementById('priceClose');

            box.style.display = 'block';
            let startTime = Date.now();
            let totalTime = seconds * 1000;

            let timerId = setInterval(() => {
                let elapsed = Date.now() - startTime;
                let remaining = totalTime - elapsed;
                let pct = (elapsed / totalTime) * 100;

                if (remaining <= 0) {
                    clearInterval(timerId);
                    txt.innerText = "00:00";
                    fill.style.width = "100%";
                    
                    // –§–ò–ù–ê–õ: –°–∏–º—É–ª—è—Ü–∏—è –∏—Å—Ö–æ–¥–∞
                    // –î–∞–∂–µ –ø—Ä–∏ 90% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –µ—Å—Ç—å —à–∞–Ω—Å 10% –Ω–∞ –º–∏–Ω—É—Å.
                    let isWin = Math.random() * 100 < probability;
                    
                    // –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (–¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –∑–∞ –≤—Ä–µ–º—è —Å–¥–µ–ª–∫–∏)
                    let volatility = startPrice * 0.00045; 
                    let change = volatility * (Math.random() + 0.1);
                    
                    let endPrice;
                    if(isWin) {
                        endPrice = isUp ? startPrice + change : startPrice - change;
                        resEl.innerText = "‚úÖ ITM (–ü–õ–Æ–°)";
                        resEl.style.color = "#00ff88";
                        fill.style.background = "#00ff88";
                        fill.style.boxShadow = "0 0 15px #00ff88";
                    } else {
                        endPrice = isUp ? startPrice - change : startPrice + change;
                        resEl.innerText = "‚ùå OTM (–ú–ò–ù–£–°)";
                        resEl.style.color = "#ff004c";
                        fill.style.background = "#ff004c";
                        fill.style.boxShadow = "0 0 15px #ff004c";
                    }
                    closeEl.innerText = endPrice.toFixed(decimals);
                    
                    document.querySelector('.btn-main').disabled = false;
                    document.querySelector('.btn-main').innerText = "–ù–û–í–´–ô –ê–ù–ê–õ–ò–ó";
                } else {
                    let m = Math.floor(remaining / 60000);
                    let s = Math.floor((remaining % 60000) / 1000);
                    txt.innerText = `${m}:${s.toString().padStart(2, '0')}`;
                    fill.style.width = pct + "%";
                }
            }, 100);
        }

        initChart();
    </script>
</body>
</html>
