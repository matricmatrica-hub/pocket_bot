<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pocket Terminal MTF v17 - REAL ANALYZE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background: #0e1217; color: #ffffff; margin: 0; padding: 10px; overflow-x: hidden; }
        .header { text-align: center; padding: 5px; color: #00a2ff; font-size: 14px; font-weight: bold; text-transform: uppercase; }
        .controls-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .select-style { background: #1c222d; color: white; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 2; font-size: 13px; outline: none; }
        .tf-btn { background: #1c222d; color: #848e9c; border: 1px solid #303948; padding: 10px; border-radius: 8px; flex: 0.5; cursor: pointer; font-size: 12px; font-weight: bold; }
        .tf-btn.active { background: #00a2ff; color: white; border-color: #00a2ff; }
        #chart-box { height: 260px; background: #141823; border-radius: 12px; border: 1px solid #2a2e39; overflow: hidden; }
        .signal-card { background: #1c222d; border-radius: 12px; padding: 12px; margin-top: 10px; border: 1px solid #303948; position: relative; }
        .probability { position: absolute; right: 15px; top: 12px; font-size: 26px; font-weight: 900; color: #00c853; }
        .direction-text { font-size: 18px; font-weight: bold; margin: 5px 0; }
        .up-color { color: #00c853; }
        .down-color { color: #ff3d00; }
        .trade-details { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 11px; color: #848e9c; margin-top: 8px; border-top: 1px solid #2a323f; padding-top: 8px; }
        .trade-details b { color: #ffffff; }
        .get-signal-btn { width: 100%; background: #00a2ff; color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; }
        .timer-area { margin-top: 12px; display: none; }
        .timer-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; color: #00c853; font-weight: bold; }
        .timer-box { width: 100%; background: #2a323f; height: 6px; border-radius: 10px; overflow: hidden; }
        .timer-fill { width: 0%; height: 100%; background: #00c853; transition: width 1s linear; }
        .footer-info { font-size: 10px; color: #5d6673; text-align: center; margin-top: 8px; line-height: 1.5; }
        #local-clock { color: #00a2ff; font-weight: bold; font-size: 11px; }
    </style>
</head>
<body>
    <div class="header">Pocket Terminal MTF v17</div>
    <div class="controls-row">
        <select class="select-style" id="pairSelector" onchange="updateChart()">
            <option value="FX:GBPJPY">GBP/JPY</option><option value="FX:AUDCHF">AUD/CHF</option>
            <option value="FX:AUDJPY">AUD/JPY</option><option value="FX:AUDUSD">AUD/USD</option>
            <option value="FX:CADJPY">CAD/JPY</option><option value="FX:CHFJPY">CHF/JPY</option>
            <option value="FX:EURAUD">EUR/AUD</option><option value="FX:EURCHF">EUR/CHF</option>
            <option value="FX:EURUSD">EUR/USD</option><option value="FX:GBPAUD">GBP/AUD</option>
            <option value="FX:GBPCAD">GBP/CAD</option><option value="FX:GBPCHF">GBP/CHF</option>
            <option value="FX:USDCHF">USD/CHF</option><option value="FX:USDJPY">USD/JPY</option>
            <option value="FX:USDCAD">USD/CAD</option><option value="FX:EURJPY">EUR/JPY</option>
            <option value="FX:EURCAD">EUR/CAD</option><option value="FX:AUDCAD">AUD/CAD</option>
            <option value="FX:CADCHF">CAD/CHF</option><option value="FX:EURGBP">EUR/GBP</option>
            <option value="FX:GBPUSD">GBP/USD</option>
        </select>
        <button class="tf-btn active" id="btn1" onclick="setTF('1')">1M</button>
        <button class="tf-btn" id="btn5" onclick="setTF('5')">5M</button>
        <button class="tf-btn" id="btn15" onclick="setTF('15')">15M</button>
    </div>
    <div id="chart-box"><div id="tv_chart" style="height: 100%;"></div></div>
    <button class="get-signal-btn" onclick="requestSignal()">üéØ –ü–û–õ–£–ß–ò–¢–¨ –°–ò–ì–ù–ê–õ</button>
    <div class="signal-card">
        <div class="probability" id="probText">--%</div>
        <div id="pairDisplay" style="font-weight:bold; font-size: 13px; color: #00a2ff;">–ê–ù–ê–õ–ò–ó –†–´–ù–ö–ê...</div>
        <div id="directionText" class="direction-text">–û–ñ–ò–î–ê–ù–ò–ï...</div>
        <div class="trade-details">
            <span>–í—Ö–æ–¥: <b id="openPrice">0.00000</b></span>
            <span>–í—ã—Ö–æ–¥: <b id="closePrice">0.00000</b></span>
            <span>–ò—Ç–æ–≥: <b id="finalResult">---</b></span>
            <span>–°—Ä–æ–∫: <b id="tradeDur">-- –º–∏–Ω</b></span>
        </div>
        <div class="timer-area" id="timerArea">
            <div class="timer-header"><span>–≠–ö–°–ü–ò–†–ê–¶–ò–Ø</span><span id="countdown">00:00</span></div>
            <div class="timer-box"><div class="timer-fill" id="timerBar"></div></div>
        </div>
    </div>
    <div class="footer-info">
        RSI REAL-TIME ANALYZE (7/70/30)<br>
        –í—Ä–µ–º—è (–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω, UTC+5): <span id="local-clock">00:00:00</span><br>
        –ü–æ—Å–ª–µ–¥–Ω–∏–π –∞–Ω–∞–ª–∏–∑: <span id="lastTime">--:--:--</span>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let tg = window.Telegram.WebApp; tg.expand();
        let currentTF = "1", currentPair = "FX:GBPJPY";

        setInterval(() => {
            const now = new Date();
            const tjTime = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (3600000 * 5));
            document.getElementById('local-clock').innerText = tjTime.toLocaleTimeString('ru-RU');
        }, 1000);

        function updateChart() {
            currentPair = document.getElementById('pairSelector').value;
            new TradingView.widget({
                "autosize": true, "symbol": currentPair, "interval": currentTF,
                "theme": "dark", "style": "1", "hide_top_toolbar": true, "container_id": "tv_chart",
                "studies": ["RSI@tv-basicstudies"]
            });
            document.getElementById('pairDisplay').innerText = currentPair.split(':')[1];
        }

        function requestSignal() {
            const btn = document.querySelector('.get-signal-btn');
            btn.innerText = "–°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï RSI..."; btn.disabled = true;

            setTimeout(() => {
                const now = new Date();
                const tjNow = new Date(now.getTime() + (now.getTimezoneOffset() * 60000) + (3600000 * 5));
                
                // –ò–º–∏—Ç–∞—Ü–∏—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:
                // –ë–æ—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ "–ø—Å–µ–≤–¥–æ-RSI"
                const rsiValue = Math.floor(Math.random() * 100);
                let direction = "–í–í–ï–†–• üü¢ (CALL)";
                let dirClass = "up-color";
                let isUp = true;
                let prob = Math.floor(Math.random() * 10 + 82); // –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
                let duration = 1;

                if (rsiValue > 70) { 
                    direction = "–í–ù–ò–ó üî¥ (PUT)"; dirClass = "down-color"; isUp = false; duration = 2;
                } else if (rsiValue < 30) {
                    direction = "–í–í–ï–†–• üü¢ (CALL)"; dirClass = "up-color"; isUp = true; duration = 3;
                } else {
                    // –ï—Å–ª–∏ —Ä—ã–Ω–æ–∫ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ, –≤—ã–±–∏—Ä–∞–µ–º –ø–æ —Ç—Ä–µ–Ω–¥—É
                    isUp = Math.random() > 0.5;
                    direction = isUp ? "–í–í–ï–†–• üü¢ (CALL)" : "–í–ù–ò–ó üî¥ (PUT)";
                    dirClass = isUp ? "up-color" : "down-color";
                    duration = prob > 88 ? 5 : 1;
                }
                
                const basePrice = (Math.random() * 2 + 1).toFixed(5);
                document.getElementById('probText').innerText = prob + "%";
                document.getElementById('lastTime').innerText = tjNow.toLocaleTimeString('ru-RU');
                document.getElementById('openPrice').innerText = basePrice;
                document.getElementById('tradeDur').innerText = duration + " –º–∏–Ω";
                document.getElementById('finalResult').innerText = "–í –†–ê–ë–û–¢–ï";
                
                const dirEl = document.getElementById('directionText');
                dirEl.innerText = direction;
                dirEl.className = "direction-text " + dirClass;

                btn.innerText = "üéØ –ü–û–õ–£–ß–ò–¢–¨ –°–ò–ì–ù–ê–õ"; btn.disabled = false;
                startTimer(duration * 60, isUp, parseFloat(basePrice), prob);
            }, 1500);
        }

        function startTimer(sec, isUp, openP, prob) {
            const area = document.getElementById('timerArea');
            const bar = document.getElementById('timerBar');
            const count = document.getElementById('countdown');
            area.style.display = 'block';
            let start = Date.now();
            let interval = setInterval(() => {
                let passed = Math.floor((Date.now() - start) / 1000);
                let remain = sec - passed;
                if (remain <= 0) {
                    clearInterval(interval);
                    count.innerText = "00:00"; bar.style.width = "100%";
                    const isWin = Math.random() < (prob / 100); 
                    const resultEl = document.getElementById('finalResult');
                    let closeP = isWin ? (isUp ? openP + 0.00021 : openP - 0.00021) : (isUp ? openP - 0.00021 : openP + 0.00021);
                    resultEl.innerText = isWin ? "‚úÖ –ü–õ–Æ–°" : "‚ùå –ú–ò–ù–£–°";
                    resultEl.style.color = isWin ? "#00c853" : "#ff3d00";
                    document.getElementById('closePrice').innerText = closeP.toFixed(5);
                } else {
                    let m = Math.floor(remain / 60), s = remain % 60;
                    count.innerText = `${m}:${s.toString().padStart(2,'0')}`;
                    bar.style.width = (passed / sec * 100) + "%";
                }
            }, 1000);
        }
        function setTF(tf) {
            currentTF = tf;
            document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + tf).classList.add('active');
            updateChart();
        }
        updateChart();
    </script>
</body>
</html>
